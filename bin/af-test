#!/usr/bin/env php
<?php
/**
 * Appfuel
 * PHP 5.3+ object oriented MVC framework supporting domain driven design. 
 *
 * @package     Appfuel
 * @author      Robert Scott-Buccleuch <rsb.code@gmail.com.com>
 * @copyright   2009-2011 Robert Scott-Buccleuch <rsb.code@gmail.com>
 * @license		http://www.apache.org/licenses/LICENSE-2.0
 */
use Appfuel\App\AppManager,
	Hare\Messenger;

/*
 * returns the base path and makes sure the app manager file and dependencies
 * are run
 */
$base    = require 'af-cli-header.php';
$manager = new AppManager($base, 'app-console');
$manager->initialize();

$messenger = new Messenger();
$messenger->sendTo('this is a message', 'hare-broadcaster');

$messenger->consume('local-connection', 'hare-consumer');

$depend = new \Appfuel\MsgBroker\Amqp\Dependency();
$depend->load();

$params = array(
	'host'		=> 'localhost', 
	'port'		=> 5672, 
	'user'		=> 'unit_tester', 
	'password'	=> 'w3bG33k3r', 
	'vhost'		=> 'unit_test'
);

$consumer = new \TaskManager\TMConsumer();
$handler  = new \Appfuel\MsgBroker\Amqp\ConsumeHandler($params, $consumer);
$handler->initialize();
$handler->consume();
