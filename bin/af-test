#!/usr/bin/env php
<?php
/**
 * Appfuel
 * PHP 5.3+ object oriented MVC framework supporting domain driven design. 
 *
 * @package     Appfuel
 * @author      Robert Scott-Buccleuch <rsb.code@gmail.com.com>
 * @copyright   2009-2011 Robert Scott-Buccleuch <rsb.code@gmail.com>
 * @license		http://www.apache.org/licenses/LICENSE-2.0
 */

use Appfuel\App\AppManager;

/* we kmow we are in the bin directory and one level up is the base path */
$base = realpath(dirname(__FILE__) . '/..');

$file = "$base/lib/Appfuel/App/AppManager.php";
if (! file_exists($file)) {
    $err = "Could not locate Manager file at ($file)\n";
    fwrite(STDERR, $err);
    exit;
}
require_once $file;

//define("AMQP_DEBUG", true);
$manager = new AppManager($base, 'app-console');
$manager->initialize();

$depend = new \Appfuel\MsgBroker\Amqp\Dependency();
$depend->load();

$conn = new AMQPConnection('localhost', 5672, 'unit_tester', 'w3bG33k3r', 'unit_test');
$channel = $conn->channel();

//$channel->exchange_delete('my-exchange');
$channel->queue_delete('my-test-queue');


function shutdown($channel, $conn){
    $channel->close();
    $conn->close();
}
register_shutdown_function('shutdown', $channel, $conn);

echo "\n", print_r('ok',1), "\n";exit;
